<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maishiy texnika ta'mirlash</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="./css/main.css" />
  </head>

  <body
    data-bs-spy="scroll"
    data-bs-target="#mainNavbar"
    data-bs-offset="80"
    tabindex="0"
  >
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm fixed-top"
    >
      <div class="container">
        <a class="navbar-brand" href="#">
          <i class="fas fa-tools"></i> Maishiy Texnika
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#mainNavbar"
          aria-controls="mainNavbar"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse justify-content-end"
          id="mainNavbar"
        >
          <ul class="navbar-nav mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" href="#mainHeroBg" id="navAsosiy"
                >Asosiy</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#aboutSection" id="navAbout"
                >Nega aynana biz?</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#servicesSection" id="navServices"
                >Xizmatlarimiz</a
              >
            </li>
          </ul>
          <button
            class="btn btn-warning btn-usta ms-lg-3"
            onclick="openModal('repairForm')"
            type="button"
          >
            <i class="fas fa-user-cog"></i> Usta chaqirish
          </button>
          <button
            id="adminPanelBtn"
            class="btn btn-outline-light ms-2"
            type="button"
            onclick="handleAdminPanelClick(event)"
          >
            <i class="fas fa-user-shield"></i> Admin panel
          </button>
        </div>
      </div>
    </nav>

    <!-- MAIN CONTENT START -->
    <div class="main-hero-wrapper" id="mainHeroBg">
      <div class="main-hero-left">
        <h1 class="main-hero-title">
          Maishiy texnikalarni ta'mirlash sahifasiga xush kelibsiz!
        </h1>
        <div class="main-hero-steps">
          <div class="step-item">
            <span class="step-circle">1</span>
            <span class="step-text">Arizani yuboring</span>
          </div>
          <div class="step-arrow"><i class="fas fa-arrow-right"></i></div>
          <div class="step-item">
            <span class="step-circle">2</span>
            <span class="step-text">Usta siz bilan bog'lanadi</span>
          </div>
          <div class="step-arrow"><i class="fas fa-arrow-right"></i></div>
          <div class="step-item">
            <span class="step-circle">3</span>
            <span class="step-text">Tez va sifatli ta'mirlash</span>
          </div>
        </div>
        <!-- <div class="main-hero-slogan mt-4">
          <i class="fas fa-bolt text-warning"></i>
          <span
            >Hayotingizni osonlashtiramiz, texnikangizga hayot baxsh
            etamiz!</span
          >
        </div> -->
      </div>
      <div class="main-hero-right" id="header"></div>
    </div>
    <!-- MAIN CONTENT END -->

    <!-- BIZ HAQIMIZDA SECTION START -->
    <section id="aboutSection" class="about-creative-section">
      <div class="container about-creative-container">
        <div class="about-creative-left">
          <h2 class="about-creative-title">Nega aynan biz?</h2>
          <p class="about-creative-desc">
            <b>Bizning markazda</b> — zamonaviy va ishonchli maishiy texnika
            ta’mirlash markazi. Biz har bir mijoz uchun qulaylik, tezkorlik va
            sifatli xizmatni kafolatlaymiz. Ustalarimiz tajribali, narxlarimiz
            esa do‘stona!
          </p>
          <div class="about-creative-features">
            <div class="about-creative-feature">
              <span class="icon"><i class="fas fa-bolt"></i></span>
              <span>Tezkor va sifatli xizmat</span>
            </div>
            <div class="about-creative-feature">
              <span class="icon"><i class="fas fa-shield-alt"></i></span>
              <span>Kafolat va ishonch</span>
            </div>
            <div class="about-creative-feature">
              <span class="icon"><i class="fas fa-users"></i></span>
              <span>Do‘stona va tajribali jamoa</span>
            </div>
            <div class="about-creative-feature">
              <span class="icon"><i class="fas fa-headset"></i></span>
              <span>24/7 qo‘llab-quvvatlash</span>
            </div>
          </div>
          <a href="tel:+998901234567" class="about-creative-btn">
            <i class="fas fa-phone"></i> Biz bilan bog‘laning
          </a>
        </div>
        <div class="about-creative-right">
          <div class="about-creative-imgbox">
            <img src="./img/about.jpg" alt="APEX Servis" />
            <div class="about-creative-badge">
              <i class="fas fa-award"></i>
              <span>20+ yil tajriba</span>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- BIZ HAQIMIZDA SECTION END -->

    <!-- XIZMATLARIMIZ SECTION START -->
    <section id="servicesSection" class="services-section">
      <div class="container">
        <h2 class="services-title mb-4">
          <i class="fas fa-tools text-warning"></i> Xizmatlarimiz
        </h2>
        <div class="services-grid">
          <div class="service-card">
            <div class="service-icon"><i class="fas fa-wrench"></i></div>
            <h3 class="service-title">Maishiy texnika ta’miri</h3>
            <p class="service-desc">
              Kir yuvish mashinasi, muzlatgich, gaz plitasi va boshqa
              texnikalarni tez va sifatli ta’mirlash.
            </p>
          </div>
          <div class="service-card">
            <div class="service-icon"><i class="fas fa-plug"></i></div>
            <h3 class="service-title">O‘rnatish va ulash</h3>
            <p class="service-desc">
              Yangi texnikani professional o‘rnatish va to‘g‘ri ulash
              xizmatlari.
            </p>
          </div>
          <div class="service-card">
            <div class="service-icon"><i class="fas fa-sync-alt"></i></div>
            <h3 class="service-title">Profilaktika va tozalash</h3>
            <p class="service-desc">
              Texnikangiz uzoq ishlashi uchun muntazam profilaktika va tozalash
              ishlari.
            </p>
          </div>
          <div class="service-card">
            <div class="service-icon"><i class="fas fa-shield-alt"></i></div>
            <h3 class="service-title">Kafolatli xizmat</h3>
            <p class="service-desc">
              Barcha xizmatlarimizga kafolat va bepul maslahatlar taqdim etamiz.
            </p>
          </div>
          <div class="service-card">
            <div class="service-icon"><i class="fas fa-headset"></i></div>
            <h3 class="service-title">24/7 qo‘llab-quvvatlash</h3>
            <p class="service-desc">
              Telefon orqali doimiy maslahat va yordam, har doim aloqadamiz.
            </p>
          </div>
          <div class="service-card">
            <div class="service-icon"><i class="fas fa-user-check"></i></div>
            <h3 class="service-title">Malakali ustalar</h3>
            <p class="service-desc">
              Tajribali va malakali ustalarimiz har bir buyurtmani e’tibor bilan
              bajaradi.
            </p>
          </div>
        </div>
      </div>
    </section>
    <!-- XIZMATLARIMIZ SECTION END -->

    <!-- BIZNING USTALAR SECTION START -->
    <section id="teamSection" class="team-section">
      <div class="container">
        <div class="team-header">
          <span class="team-label">JAMOA</span>
          <h2 class="team-title">Tajribali ustalarimiz</h2>
        </div>
        <div id="teamGrid" class="team-grid"></div>
      </div>
    </section>
    <!-- BIZNING USTALAR SECTION END -->

    <!-- MIJOZLARIMIZ FIKRI (FEEDBACK) SECTION START -->
    <section id="feedbackSection" class="feedback-section">
      <div class="container">
        <div class="feedback-header">
          <span class="feedback-label">MIJOZLARIMIZ FIKRI</span>
          <h2 class="feedback-title">Biz haqimizda fikrlar</h2>
        </div>
        <div id="feedbackGrid" class="feedback-grid"></div>
      </div>
    </section>
    <!-- MIJOZLARIMIZ FIKRI (FEEDBACK) SECTION END -->

    <!-- Toast notification -->
    <div
      id="toast"
      style="
        display: none;
        position: fixed;
        top: 30px;
        right: 30px;
        z-index: 9999;
      "
    ></div>

    <!-- ADMIN PANEL MODAL -->
    <div class="modal-container" id="adminPanelModal">
      <div class="modal-content">
        <h4 class="mb-3">
          <i class="fas fa-user-shield"></i> Admin Panelga Kirish
        </h4>
        <form id="adminLoginForm">
          <input
            type="text"
            id="adminUsername"
            class="form-control my-2"
            placeholder="Username"
            required
            autocomplete="username"
          />
          <input
            type="password"
            id="adminPassword"
            class="form-control my-2"
            placeholder="Parol"
            required
            autocomplete="current-password"
          />
          <button type="submit" class="btn btn-success">
            <i class="fas fa-sign-in-alt"></i> Kirish
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeModal()"
          >
            Bekor qilish
          </button>
        </form>
        <div
          id="adminLoginError"
          class="text-danger mt-2"
          style="display: none"
        ></div>
      </div>
    </div>

    <!-- Footer START -->
    <footer>
      <div class="container py-3">
        <div
          class="footer-content"
          style="
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 18px;
          "
        >
          <div
            class="footer-brand"
            style="display: flex; align-items: center; gap: 10px"
          >
            <i class="fas fa-tools"></i>
            <span style="font-weight: bold; font-size: 1.13rem"
              >Maishiy Texnika</span
            >
          </div>
          <div class="footer-info" style="font-size: 1.01rem">
            © 2025 Barcha huquqlar himoyalangan.
          </div>
          <div
            class="footer-contact"
            style="display: flex; align-items: center; gap: 14px"
          >
            <a href="tel:+998901234567" class="footer-link">
              <i class="fas fa-phone"></i> +998 90 123 45 67
            </a>
            <a href="mailto:info@ourservice.uz" class="footer-link">
              <i class="fas fa-envelope"></i> info@ourservice.uz
            </a>
            <a
              href="https://t.me/bizningservis"
              target="_blank"
              class="footer-link"
            >
              <i class="fab fa-telegram"></i>
              @bizningservis
            </a>
          </div>
        </div>
      </div>
    </footer>
    <!-- Footer END -->

    <div class="modal-container" id="applicationsSection">
      <div class="modal-content">
        <ul class="list-group text-dark" id="applicationsList"></ul>
        <button class="btn btn-danger mt-3" onclick="closeModal()">
          <i class="fas fa-times"></i> Yopish
        </button>
      </div>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="./js/hero-bg.js"></script>
  <script src="./js/admin.js"></script>
  <script>
    // Toast function

    const header = document.querySelector("#header");

    function isUserAdmin() {
      return localStorage.getItem("isAdmin") === "true";
    }

    function HeaderInit() {
      if (isUserAdmin()) {
        header.innerHTML = `  <div class="py-5">
          <button
            class="btn btn-info animated-button"
            onclick="openModal('applicationsSection')"
          >
            <i class="fas fa-list"></i> Arizalar
          </button>
          
        </div>
      `;
      } else {
        header.innerHTML = `<div class="main-hero-form-block">
          <h3 class="mb-3 text-primary">
            <i class="fas fa-user-cog"></i> Usta chaqirish
          </h3>
          <form id="repairFormElement">
            <input
              type="text"
              id="name"
              name="name"
              class="form-control my-2"
              placeholder="Ismingiz"
              required
            />
            <input
              type="tel"
              id="phone"
              name="phone"
              class="form-control my-2"
              placeholder="Telefon raqamingiz"
              pattern="[0-9]+"
              required
            />
            <input
              type="text"
              id="device"
              name="device"
              class="form-control my-2"
              placeholder="Tamirlanadigan texnika"
              required
            />
            <input
              type="text"
              id="address"
              name="address"
              class="form-control my-2"
              placeholder="Manzil"
              required
            />
            <input
              type="date"
              id="date"
              name="date"
              class="form-control my-2"
              required
            />
            <button type="submit" class="btn btn-warning w-100 py-2 fw-bold">
              <i class="fas fa-paper-plane"></i> Ariza qoldirish
            </button>
          </form>
        </div>`;
      }
    }

    HeaderInit();
    function showToast(message, type = "success") {
      const toast = document.getElementById("toast");
      toast.innerText = message;
      toast.style.display = "block";
      toast.style.background =
        type === "success"
          ? "linear-gradient(90deg, #28a745 60%, #43e97b 100%)"
          : "linear-gradient(90deg, #dc3545 60%, #ff5858 100%)";
      toast.style.color = "#fff";
      toast.style.borderRadius = "12px";
      toast.style.fontWeight = "bold";
      toast.style.padding = "18px 28px";
      toast.style.boxShadow = "0 2px 12px rgba(30,60,114,0.13)";
      toast.style.fontSize = "1.08em";
      toast.style.letterSpacing = "0.01em";
      setTimeout(() => {
        toast.style.display = "none";
      }, 3500);
    }

    // AJAX form submit
    document
      .getElementById("repairFormElement")
      ?.addEventListener("submit", function (e) {
        e.preventDefault();
        const form = e.target;
        const data = new FormData(form);

        fetch("php/usta_chaqirish.php", {
          method: "POST",
          body: data,
        })
          .then((res) => res.json())
          .then((res) => {
            if (res.success) {
              showToast("Ariza muvaffaqiyatli qoldirildi!", "success");
              form.reset();
            } else {
              showToast(
                "Ariza qoldirishda xatolik yuz berdi. Iltimos, qayta urinib ko‘ring.",
                "error"
              );
            }
          })
          .catch(() => {
            showToast(
              "Tarmoqda xatolik. Iltimos, internetingizni tekshiring.",
              "error"
            );
          });
      });

    // Modalni yopish uchun funksiya
    function closeModal() {
      document
        .querySelectorAll(".modal-container")
        .forEach((modal) => modal.classList.remove("active"));
    }

    function openModal(modalId) {
      loadApplications();

      document
        .querySelectorAll(".modal-container")
        .forEach((modal) => modal.classList.remove("active"));
      document.getElementById(modalId).classList.add("active");
    }

    async function loadApplications() {
      const list = document.getElementById("applicationsList");
      if (list) {
        list.innerHTML = `
      <li class="list-group-item text-center" style="background:transparent;box-shadow:none;">
        <div class="spinner-border text-primary" role="status" style="width:2rem;height:2rem;">
          <span class="visually-hidden">Yuklanmoqda...</span>
        </div>
      </li>
    `;
        try {
          const res = await fetch("./php/get_applications.php");
          const data = await res.json();
          if (Array.isArray(data) && data.length > 0) {
            list.innerHTML = "";
            data.forEach((app) => {
              const li = document.createElement("li");
              li.className =
                "list-group-item d-flex justify-content-between align-items-center flex-wrap";
              let statusBadge = "";
              if (app.status === "bajarildi") {
                statusBadge =
                  '<span class="badge bg-success me-2"><i class="fas fa-check-circle"></i> Bajarildi</span>';
              } else {
                statusBadge =
                  '<span class="badge bg-secondary me-2"><i class="fas fa-clock"></i> Bajarilmadi</span>';
              }
              let actionBtn = "";
              if (app.status === "bajarilmadi") {
                actionBtn = `
              <button class="btn btn-success btn-sm mark-done-btn me-2" data-id="${app.id}" title="Bajarildi qilish">
                <i class="fas fa-check"></i>
              </button>
            `;
              } else {
                actionBtn = `
              <button class="btn btn-danger btn-sm delete-btn" data-id="${app.id}" title="O'chirish">
                <i class="fas fa-trash"></i>
              </button>
            `;
              }
              li.innerHTML = `
            <div class="text-start flex-grow-1">
              <span class="fw-bold">${app.name}</span>
              <span class="text-muted">(${app.phone})</span>
              <div>
                <span class="device">${app.device}</span>
                <span class="address"> | ${app.address}</span>
                <span class="date"> | ${app.date}</span>
              </div>
            </div>
            <div class="d-flex align-items-center">
              ${statusBadge}
              ${actionBtn}
            </div>
          `;
              list.appendChild(li);
            });
            // Mark as done
            document.querySelectorAll(".mark-done-btn").forEach((btn) => {
              btn.addEventListener("click", async function () {
                const id = this.getAttribute("data-id");
                await markAsDone(id);
                loadApplications();
              });
            });
            // Delete
            document.querySelectorAll(".delete-btn").forEach((btn) => {
              btn.addEventListener("click", async function () {
                const id = this.getAttribute("data-id");
                if (confirm("Haqiqatan ham o'chirmoqchimisiz?")) {
                  await deleteApplication(id);
                  loadApplications();
                }
              });
            });
          } else {
            list.innerHTML =
              '<li class="list-group-item text-center">Arizalar topilmadi.</li>';
          }
        } catch (e) {
          list.innerHTML =
            '<li class="list-group-item text-danger text-center">Xatolik yuz berdi!</li>';
        }
      }
    }

    async function markAsDone(id) {
      try {
        const res = await fetch("./php/mark_done.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: "id=" + encodeURIComponent(id),
        });
        const data = await res.json();
        if (data.success) {
          showToast("Ariza bajarildi!");
        } else {
          showToast("Statusni o'zgartirib bo'lmadi!", true);
        }
      } catch (e) {
        showToast("Tarmoq xatosi!", true);
      }
    }

    async function deleteApplication(id) {
      try {
        const res = await fetch("./php/delete_application.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: "id=" + encodeURIComponent(id),
        });
        const data = await res.json();
        if (data.success) {
          showToast("Ariza o'chirildi!");
        } else {
          showToast("O'chirishda xatolik!", true);
        }
      } catch (e) {
        showToast("Tarmoq xatosi!", true);
      }
    }
    // Ustalar array va render
    const ustalar = [
      {
        name: "Alisher Akbarov",
        job: "Muzlatgich ustasi",
        img: "./img/team/team.jpg",
        device: "Muzlatgich, Kir yuvish mashinasi",
      },
      {
        name: "Akbar Vohidov",
        job: "Mikroto‘lqinli pechlar mutaxassisi",
        img: "./img/team/team2.jpg",
        device: "Mikroto‘lqinli pech, Plita",
      },
      {
        name: "Ozodbek Aliyev",
        job: "Televizor va Audio ustasi",
        img: "./img/team/team3.jpg",
        device: "Televizor, Audio texnika",
      },
      {
        name: "Dilshod Karimov",
        job: "Konditsioner ustasi",
        img: "./img/team/team2.jpg",
        device: "Konditsioner, Ventilyator",
      },
      {
        name: "Javlonbek Sodiqov",
        job: "Changyutgich ustasi",
        img: "./img/team/team3.jpg",
        device: "Changyutgich, Blender",
      },
      {
        name: "Sardorbek Mamatov",
        job: "Qaynatkich va kichik texnika",
        img: "./img/team/team2.jpg",
        device: "Qaynatkich, Kichik maishiy texnika",
      },
    ];

    function renderTeam() {
      const grid = document.getElementById("teamGrid");
      grid.innerHTML = ustalar
        .map(
          (u) => `
        <div class="team-card">
          <div class="team-imgbox">
            <img src="${u.img}" alt="${u.name}">
          </div>
          <div class="team-info">
            <div class="team-name">${u.name}</div>
            <div class="team-job">${u.job}</div>
            <div class="team-device"><i class="fas fa-tools"></i> ${u.device}</div>
          </div>
        </div>
      `
        )
        .join("");
    }
    document.addEventListener("DOMContentLoaded", renderTeam);

    // Feedback array va render
    const feedbacks = [
      {
        name: "Gulnora Xudoyberdiyeva",
        text: "Ustalar juda tez yetib kelishdi va muammoni bir kunda hal qilishdi. Narxlari ham o‘rtacha, juda mamnunman!",
        img: "./img/user/user1.jpg",
        rating: 5,
      },
      {
        name: "Sardorbek Qodirov",
        text: "Muzlatgichim buzilib qolgandi. Telefon qilganimdan so‘ng 1 soat ichida kelishdi. Tavsiya qilaman!",
        img: "./img/user/user2.jpg",
        rating: 5,
      },
      {
        name: "Dilnoza Karimova",
        text: "Xizmat sifati yuqori, ustalar o‘z ishining ustasi. Endi faqat shu servisga murojaat qilaman.",
        img: "./img/user/user3.jpg",
        rating: 4,
      },
      {
        name: "Javohir Abdullayev",
        text: "Tez va sifatli xizmat uchun rahmat! Barcha savollarimga ham sabr bilan javob berishdi.",
        img: "./img/user/user4.jpg",
        rating: 5,
      },
    ];

    function renderFeedback() {
      const grid = document.getElementById("feedbackGrid");
      grid.innerHTML = feedbacks
        .map(
          (f) =>
            `<div class="feedback-card">
          <div class="feedback-user">
            <img src="${f.img}" alt="${f.name}">
            <div class="feedback-info">
              <div class="feedback-name">${f.name}</div>
              <div class="feedback-rating">
                ${'<i class="fas fa-star"></i>'.repeat(f.rating)}
                ${
                  f.rating < 5
                    ? '<i class="far fa-star"></i>'.repeat(5 - f.rating)
                    : ""
                }
              </div>
            </div>
          </div>
          <div class="feedback-text">"${f.text}"</div>
        </div>`
        )
        .join("");
    }
    document.addEventListener("DOMContentLoaded", renderFeedback);
  </script>
</html>
